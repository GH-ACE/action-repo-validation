import * as core from '@actions/core';
import { Octokit } from '@octokit/core';

export async function vulnerabilityBotCheck(repository: string, validationResultRepo: any, ownername: string, secret_token: string, octokit: Octokit) {
    try{
      const result = await octokit.request('GET /repos/{owner}/{repo}/vulnerability-alerts',{
        repo: repository,
        owner: ownername,
        headers : { 
          Authorization: 'Bearer ' + secret_token,
        },
        mediaType: {
          previews: [
            'dorian'
          ]
        }
      }); 
      // console.log(result);
      if(result.status == 204){
        //console.log('Success - Vulnerability bot is enabled');
        validationResultRepo['vulnerabilityBot'] = 'pass';
      }
      else{
        //core.setFailed('Please enable vulnerability bot');
        validationResultRepo['vulnerabilityBot'] = 'fail';
      }
    }
    catch(err){
      validationResultRepo['vulnerabilityBot'] = 'Access reqd';
    }
    return Promise.resolve(validationResultRepo)
}